function _argumentsToArray(e){return[].concat.apply([],Array.prototype.slice.apply(e))}function radians(e){return e*Math.PI/180}function vec2(){var e=_argumentsToArray(arguments);switch(e.length){case 0:e.push(0);case 1:e.push(0)}return e.splice(0,2)}function vec3(){var e=_argumentsToArray(arguments);switch(e.length){case 0:e.push(0);case 1:e.push(0);case 2:e.push(0)}return e.splice(0,3)}function vec4(){var e=_argumentsToArray(arguments);switch(e.length){case 0:e.push(0);case 1:e.push(0);case 2:e.push(0);case 3:e.push(1)}return e.splice(0,4)}function mat2(){var e=_argumentsToArray(arguments),t=[];switch(e.length){case 0:e[0]=1;case 1:t=[vec2(e[0],0),vec2(0,e[0])];break;default:t.push(vec2(e)),e.splice(0,2),t.push(vec2(e))}return t.matrix=!0,t}function mat3(){var e=_argumentsToArray(arguments),t=[];switch(e.length){case 0:e[0]=1;case 1:t=[vec3(e[0],0,0),vec3(0,e[0],0),vec3(0,0,e[0])];break;default:t.push(vec3(e)),e.splice(0,3),t.push(vec3(e)),e.splice(0,3),t.push(vec3(e))}return t.matrix=!0,t}function mat4(){var e=_argumentsToArray(arguments),t=[];switch(e.length){case 0:e[0]=1;case 1:t=[vec4(e[0],0,0,0),vec4(0,e[0],0,0),vec4(0,0,e[0],0),vec4(0,0,0,e[0])];break;default:t.push(vec4(e)),e.splice(0,4),t.push(vec4(e)),e.splice(0,4),t.push(vec4(e)),e.splice(0,4),t.push(vec4(e))}return t.matrix=!0,t}function equal(e,t){if(e.length!=t.length)return!1;if(e.matrix&&t.matrix)for(var r=0;r<e.length;++r){if(e[r].length!=t[r].length)return!1;for(var a=0;a<e[r].length;++a)if(e[r][a]!==t[r][a])return!1}else{if(e.matrix&&!t.matrix||!e.matrix&&t.matrix)return!1;for(r=0;r<e.length;++r)if(e[r]!==t[r])return!1}return!0}function add(e,t){var r=[];if(e.matrix&&t.matrix){if(e.length!=t.length)throw"add(): trying to add matrices of different dimensions";for(var a=0;a<e.length;++a){if(e[a].length!=t[a].length)throw"add(): trying to add matrices of different dimensions";r.push([]);for(var n=0;n<e[a].length;++n)r[a].push(e[a][n]+t[a][n])}return r.matrix=!0,r}if(e.matrix&&!t.matrix||!e.matrix&&t.matrix)throw"add(): trying to add matrix and non-matrix variables";if(e.length!=t.length)throw"add(): vectors are not the same dimension";for(a=0;a<e.length;++a)r.push(e[a]+t[a]);return r}function subtract(e,t){var r=[];if(e.matrix&&t.matrix){if(e.length!=t.length)throw"subtract(): trying to subtract matrices of different dimensions";for(var a=0;a<e.length;++a){if(e[a].length!=t[a].length)throw"subtract(): trying to subtact matrices of different dimensions";r.push([]);for(var n=0;n<e[a].length;++n)r[a].push(e[a][n]-t[a][n])}return r.matrix=!0,r}if(e.matrix&&!t.matrix||!e.matrix&&t.matrix)throw"subtact(): trying to subtact  matrix and non-matrix variables";if(e.length!=t.length)throw"subtract(): vectors are not the same length";for(a=0;a<e.length;++a)r.push(e[a]-t[a]);return r}function mult(e,t){var r=[];if(e.matrix&&t.matrix){if(e.length!=t.length)throw"mult(): trying to add matrices of different dimensions";for(var a=0;a<e.length;++a)if(e[a].length!=t[a].length)throw"mult(): trying to add matrices of different dimensions";for(a=0;a<e.length;++a){r.push([]);for(var n=0;n<t.length;++n){for(var l=0,i=0;i<e.length;++i)l+=e[a][i]*t[i][n];r[a].push(l)}}return r.matrix=!0,r}if(e.matrix&&e.length==t.length){for(a=0;a<t.length;a++){for(l=0,n=0;n<t.length;n++)l+=e[a][n]*t[n];r.push(l)}return r}if(e.length!=t.length)throw"mult(): vectors are not the same dimension";for(a=0;a<e.length;++a)r.push(e[a]*t[a]);return r}function translate(e,t,r){Array.isArray(e)&&3==e.length&&(r=e[2],t=e[1],e=e[0]);var a=mat4();return a[0][3]=e,a[1][3]=t,a[2][3]=r,a}function rotate(e,t){Array.isArray(t)||(t=[arguments[1],arguments[2],arguments[3]]);var r=normalize(t),a=r[0],n=r[1],l=r[2],i=Math.cos(radians(e)),s=1-i,o=Math.sin(radians(e));return mat4(vec4(a*a*s+i,a*n*s-l*o,a*l*s+n*o,0),vec4(a*n*s+l*o,n*n*s+i,n*l*s-a*o,0),vec4(a*l*s-n*o,n*l*s+a*o,l*l*s+i,0),vec4())}function rotateX(e){var t=Math.cos(radians(e)),r=Math.sin(radians(e));return mat4(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1)}function rotateY(e){var t=Math.cos(radians(e)),r=Math.sin(radians(e));return mat4(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1)}function rotateZ(e){var t=Math.cos(radians(e)),r=Math.sin(radians(e));return mat4(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1)}function scalem(e,t,r){Array.isArray(e)&&3==e.length&&(r=e[2],t=e[1],e=e[0]);var a=mat4();return a[0][0]=e,a[1][1]=t,a[2][2]=r,a}function lookAt(e,t,r){if(!Array.isArray(e)||3!=e.length)throw"lookAt(): first parameter [eye] must be an a vec3";if(!Array.isArray(t)||3!=t.length)throw"lookAt(): first parameter [at] must be an a vec3";if(!Array.isArray(r)||3!=r.length)throw"lookAt(): first parameter [up] must be an a vec3";if(equal(e,t))return mat4();var a=normalize(subtract(t,e)),n=normalize(cross(a,r)),l=normalize(cross(n,a));return a=negate(a),mat4(vec4(n,-dot(n,e)),vec4(l,-dot(l,e)),vec4(a,-dot(a,e)),vec4())}function ortho(e,t,r,a,n,l){if(e==t)throw"ortho(): left and right are equal";if(r==a)throw"ortho(): bottom and top are equal";if(n==l)throw"ortho(): near and far are equal";var i=t-e,s=a-r,o=l-n,c=mat4();return c[0][0]=2/i,c[1][1]=2/s,c[2][2]=-2/o,c[0][3]=-(e+t)/i,c[1][3]=-(a+r)/s,c[2][3]=-(n+l)/o,c}function perspective(e,t,r,a){var n=1/Math.tan(radians(e)/2),l=a-r,i=mat4();return i[0][0]=n/t,i[1][1]=n,i[2][2]=-(r+a)/l,i[2][3]=-2*r*a/l,i[3][2]=-1,i[3][3]=0,i}function transpose(e){if(!e.matrix)return"transpose(): trying to transpose a non-matrix";for(var t=[],r=0;r<e.length;++r){t.push([]);for(var a=0;a<e[r].length;++a)t[r].push(e[a][r])}return t.matrix=!0,t}function dot(e,t){if(e.length!=t.length)throw"dot(): vectors are not the same dimension";for(var r=0,a=0;a<e.length;++a)r+=e[a]*t[a];return r}function negate(e){for(var t=[],r=0;r<e.length;++r)t.push(-e[r]);return t}function cross(e,t){if(!Array.isArray(e)||e.length<3)throw"cross(): first argument is not a vector of at least 3";if(!Array.isArray(t)||t.length<3)throw"cross(): second argument is not a vector of at least 3";return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function length(e){return Math.sqrt(dot(e,e))}function normalize(e,t){if(t)var r=e.pop();var a=length(e);if(!isFinite(a))throw"normalize: vector "+e+" has zero length";for(var n=0;n<e.length;++n)e[n]/=a;return t&&e.push(r),e}function mix(e,t,r){if("number"!=typeof r)throw"mix: the last paramter "+r+" must be a number";if(e.length!=t.length)throw"vector dimension mismatch";for(var a=[],n=0;n<e.length;++n)a.push((1-r)*e[n]+r*t[n]);return a}function scale(e,t){if(!Array.isArray(t))throw"scale: second parameter "+t+" is not a vector";for(var r=[],a=0;a<t.length;++a)r.push(e*t[a]);return r}function flatten(e){!0===e.matrix&&(e=transpose(e));var t=e.length,r=!1;Array.isArray(e[0])&&(r=!0,t*=e[0].length);var a=new Float32Array(t);if(r)for(var n=0,l=0;l<e.length;++l)for(var i=0;i<e[l].length;++i)a[n++]=e[l][i];else for(l=0;l<e.length;++l)a[l]=e[l];return a}var sizeof={vec2:new Float32Array(flatten(vec2())).byteLength,vec3:new Float32Array(flatten(vec3())).byteLength,vec4:new Float32Array(flatten(vec4())).byteLength,mat2:new Float32Array(flatten(mat2())).byteLength,mat3:new Float32Array(flatten(mat3())).byteLength,mat4:new Float32Array(flatten(mat4())).byteLength};function printm(e){if(2==e.length)for(var t=0;t<e.length;t++)console.log(e[t][0],e[t][1]);else if(3==e.length)for(t=0;t<e.length;t++)console.log(e[t][0],e[t][1],e[t][2]);else if(4==e.length)for(t=0;t<e.length;t++)console.log(e[t][0],e[t][1],e[t][2],e[t][3])}function det2(e){return e[0][0]*e[1][1]-e[0][1]*e[1][0]}function det3(e){return e[0][0]*e[1][1]*e[2][2]+e[0][1]*e[1][2]*e[2][0]+e[0][2]*e[2][1]*e[1][0]-e[2][0]*e[1][1]*e[0][2]-e[1][0]*e[0][1]*e[2][2]-e[0][0]*e[1][2]*e[2][1]}function det4(e){var t=[vec3(e[1][1],e[1][2],e[1][3]),vec3(e[2][1],e[2][2],e[2][3]),vec3(e[3][1],e[3][2],e[3][3])],r=[vec3(e[1][0],e[1][2],e[1][3]),vec3(e[2][0],e[2][2],e[2][3]),vec3(e[3][0],e[3][2],e[3][3])],a=[vec3(e[1][0],e[1][1],e[1][3]),vec3(e[2][0],e[2][1],e[2][3]),vec3(e[3][0],e[3][1],e[3][3])],n=[vec3(e[1][0],e[1][1],e[1][2]),vec3(e[2][0],e[2][1],e[2][2]),vec3(e[3][0],e[3][1],e[3][2])];return e[0][0]*det3(t)-e[0][1]*det3(r)+e[0][2]*det3(a)-e[0][3]*det3(n)}function det(e){return 1!=e.matrix&&console.log("not a matrix"),2==e.length?det2(e):3==e.length?det3(e):4==e.length?det4(e):void 0}function inverse2(e){var t=mat2(),r=det2(e);return t[0][0]=e[1][1]/r,t[0][1]=-e[0][1]/r,t[1][0]=-e[1][0]/r,t[1][1]=e[0][0]/r,t.matrix=!0,t}function inverse3(e){var t=mat3(),r=det3(e),a=[vec2(e[1][1],e[1][2]),vec2(e[2][1],e[2][2])],n=[vec2(e[1][0],e[1][2]),vec2(e[2][0],e[2][2])],l=[vec2(e[1][0],e[1][1]),vec2(e[2][0],e[2][1])],i=[vec2(e[0][1],e[0][2]),vec2(e[2][1],e[2][2])],s=[vec2(e[0][0],e[0][2]),vec2(e[2][0],e[2][2])],o=[vec2(e[0][0],e[0][1]),vec2(e[2][0],e[2][1])],c=[vec2(e[0][1],e[0][2]),vec2(e[1][1],e[1][2])],u=[vec2(e[0][0],e[0][2]),vec2(e[1][0],e[1][2])],g=[vec2(e[0][0],e[0][1]),vec2(e[1][0],e[1][1])];return t[0][0]=det2(a)/r,t[0][1]=-det2(i)/r,t[0][2]=det2(c)/r,t[1][0]=-det2(n)/r,t[1][1]=det2(s)/r,t[1][2]=-det2(u)/r,t[2][0]=det2(l)/r,t[2][1]=-det2(o)/r,t[2][2]=det2(g)/r,t}function inverse4(e){var t=mat4(),r=det4(e),a=[vec3(e[1][1],e[1][2],e[1][3]),vec3(e[2][1],e[2][2],e[2][3]),vec3(e[3][1],e[3][2],e[3][3])],n=[vec3(e[1][0],e[1][2],e[1][3]),vec3(e[2][0],e[2][2],e[2][3]),vec3(e[3][0],e[3][2],e[3][3])],l=[vec3(e[1][0],e[1][1],e[1][3]),vec3(e[2][0],e[2][1],e[2][3]),vec3(e[3][0],e[3][1],e[3][3])],i=[vec3(e[1][0],e[1][1],e[1][2]),vec3(e[2][0],e[2][1],e[2][2]),vec3(e[3][0],e[3][1],e[3][2])],s=[vec3(e[0][1],e[0][2],e[0][3]),vec3(e[2][1],e[2][2],e[2][3]),vec3(e[3][1],e[3][2],e[3][3])],o=[vec3(e[0][0],e[0][2],e[0][3]),vec3(e[2][0],e[2][2],e[2][3]),vec3(e[3][0],e[3][2],e[3][3])],c=[vec3(e[0][0],e[0][1],e[0][3]),vec3(e[2][0],e[2][1],e[2][3]),vec3(e[3][0],e[3][1],e[3][3])],u=[vec3(e[0][0],e[0][1],e[0][2]),vec3(e[2][0],e[2][1],e[2][2]),vec3(e[3][0],e[3][1],e[3][2])],g=[vec3(e[0][1],e[0][2],e[0][3]),vec3(e[1][1],e[1][2],e[1][3]),vec3(e[3][1],e[3][2],e[3][3])],f=[vec3(e[0][0],e[0][2],e[0][3]),vec3(e[1][0],e[1][2],e[1][3]),vec3(e[3][0],e[3][2],e[3][3])],h=[vec3(e[0][0],e[0][1],e[0][3]),vec3(e[1][0],e[1][1],e[1][3]),vec3(e[3][0],e[3][1],e[3][3])],d=[vec3(e[0][0],e[0][1],e[0][2]),vec3(e[1][0],e[1][1],e[1][2]),vec3(e[3][0],e[3][1],e[3][2])],b=[vec3(e[0][1],e[0][2],e[0][3]),vec3(e[1][1],e[1][2],e[1][3]),vec3(e[2][1],e[2][2],e[2][3])],v=[vec3(e[0][0],e[0][2],e[0][3]),vec3(e[1][0],e[1][2],e[1][3]),vec3(e[2][0],e[2][2],e[2][3])],m=[vec3(e[0][0],e[0][1],e[0][3]),vec3(e[1][0],e[1][1],e[1][3]),vec3(e[2][0],e[2][1],e[2][3])],p=[vec3(e[0][0],e[0][1],e[0][2]),vec3(e[1][0],e[1][1],e[1][2]),vec3(e[2][0],e[2][1],e[2][2])];return t[0][0]=det3(a)/r,t[0][1]=-det3(s)/r,t[0][2]=det3(g)/r,t[0][3]=-det3(b)/r,t[1][0]=-det3(n)/r,t[1][1]=det3(o)/r,t[1][2]=-det3(f)/r,t[1][3]=det3(v)/r,t[2][0]=det3(l)/r,t[2][1]=-det3(c)/r,t[2][2]=det3(h)/r,t[2][3]=-det3(m)/r,t[3][0]=-det3(i)/r,t[3][1]=det3(u)/r,t[3][2]=-det3(d)/r,t[3][3]=det3(p)/r,t}function inverse(e){return 1!=e.matrix&&console.log("not a matrix"),2==e.length?inverse2(e):3==e.length?inverse3(e):4==e.length?inverse4(e):void 0}function normalMatrix(e,t){var r=mat4();if(r=inverse(transpose(e)),1!=t)return r;for(var a=mat3(),n=0;n<3;n++)for(var l=0;l<3;l++)a[n][l]=r[n][l];return a}function loadDocument(e){let t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(),4==t.readyState&&200==t.status?t.responseText:""}function initShaders(e,t,r){let a=e.createProgram();if(t){{let r=e.createShader(e.VERTEX_SHADER);if(e.shaderSource(r,t),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))return;e.attachShader(a,r)}if(r){{let t=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(t,r),e.compileShader(t),!e.getShaderParameter(t,e.COMPILE_STATUS))return;e.attachShader(a,t)}if(e.linkProgram(a),e.getProgramParameter(a,e.LINK_STATUS))return a}}}WebGLUtils=function(){var e=function(e){return'<table style="background-color: #8CE; width: 100%; height: 100%;"><tr><td align="center"><div style="display: table-cell; vertical-align: middle;"><div style="">'+e+"</div></div></td></tr></table>"},t=function(e,t){for(var r=["webgl","experimental-webgl","webkit-3d","moz-webgl"],a=null,n=0;n<r.length;++n){try{a=e.getContext(r[n],t)}catch(l){}if(a)break}return a};return{create3DContext:t,setupWebGL:function(r,a){function n(t){var a=r.parentNode;a&&(a.innerHTML=e(t))}if(!window.WebGLRenderingContext)return n('This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>'),null;var l=t(r,a);return l||n('It doesn\'t appear your computer can support WebGL.<br/><a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>'),l}}}(),window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)};const randColorFunction=(e,t)=>{let r=new Array(e.length);for(let a=0;a<e.length;a++)r[a]=vec4(Math.random(),Math.random(),Math.random(),1);return r},defaultColorFunction=(e,t)=>{let r=new Array(e.length);for(let a=0;a<e.length;a+=3){let n=3*e[a],l=3*e[a+1],i=3*e[a+2],s=normalize(cross(vec3(t[l]-t[n],t[l+1]-t[n+1],t[l+2]-t[n+2]),vec3(t[i]-t[n],t[i+1]-t[n+1],t[i+2]-t[n+2]))),o=vec4(Math.abs(s[0]),Math.abs(s[1]),Math.abs(s[2]),1);r[a]=o,r[a+1]=o,r[a+2]=o}return r},rainbowColorFunction=(e,t)=>{var r=new Array(t-e);let a=e=>Math.max(0,Math.sin(radians(e)+Math.PI/2)),n=e=>Math.max(0,Math.sin(radians(e))),l=e=>Math.max(0,Math.sin(radians(e)-Math.PI/2));for(let i=e;i<t;i++){let s=180*i/(t-e-1);r[i-e]=new vec4(a(s),n(s),l(s),1)}return r},blendedRainbowColorFunction=(e,t)=>{var r=new Array(t-e);let a=e=>Math.sin(3*radians(e)/2+Math.PI/2)+Math.max(0,-Math.sin(3*radians(e)/2)+Math.sin(3*radians(e)/2-Math.PI/2)),n=e=>Math.max(0,Math.sin(3*radians(e)/2)),l=e=>Math.max(0,Math.sin(3*radians(e)/2-Math.PI/2));for(let i=e;i<t;i++){let s=180*i/(t-e-1);r[i-e]=new vec4(a(s),n(s),l(s),1)}return r},createSolidColorFunction=e=>(t,r)=>new Array(r-t).fill(e),PROJECTIONS={Perspective:0,Parallel:1},PROJ_NAMES=["Perspective","Parallel"],MAT_DEFAULT={ambient:vec4(1,1,1,1),diffuse:vec4(1,1,1,1),specular:vec4(1,1,1,1),shininess:50},up=vec3(0,1,0),BUNNY=parseSMF(loadDocument("../assets/smf/bunny.smf")),CUBE=parseSMF(loadDocument("../assets/smf/cube.smf")),FISH=parseSMF(loadDocument("../assets/smf/fish.smf")),SPHERE=parseSMF(loadDocument("../assets/smf/sphere.smf")),TEAPOT=parseSMF(loadDocument("../assets/smf/teapot.smf")),VERT_SHADER_BASIC=loadDocument("../assets/shaders/basic.vertex"),VERT_SHADER_PHONG=loadDocument("../assets/shaders/phong.vertex"),VERT_SHADER_GOURAUD=loadDocument("../assets/shaders/gouraud.vertex"),FRAG_SHADER_BASIC=loadDocument("../assets/shaders/basic.fragment"),FRAG_SHADER_PHONG=loadDocument("../assets/shaders/phong.fragment"),FRAG_SHADER_GOURAUD=loadDocument("../assets/shaders/gouraud.fragment");var webgl_webgl;function parseSMF(e){let t=[];return e.match(/[^\r\n]+/g).forEach(e=>{let r=e.split(",");t.push(r[0]),t.push(+r[1]),t.push(+r[2]),t.push(+r[3])}),t}function createCanvas1(){webgl_webgl&&webgl_webgl.cleanup(webgl_webgl),(webgl_webgl=StandardWebGL(document.getElementById("gl-canvas"))).UseBasic(webgl_webgl),webgl_webgl.fieldDepth=[-.4,.7,-.4,.4,-1,1];let e=createPentagon(-.3,-.3,.3,-.3,.6,0,.3,.3,-.3,.3,createSolidColorFunction(vec4(1,0,0,1)));webgl_webgl.shapes.push.apply(webgl_webgl.shapes,e),renderShapes(webgl_webgl)}function createCanvas2(){webgl_webgl&&webgl_webgl.cleanup(webgl_webgl),(webgl_webgl=StandardWebGL(document.getElementById("gl-canvas"))).UseBasic(webgl_webgl),webgl_webgl.fieldDepth=1.25;let e=createSolidColorFunction(new vec4(1,0,0,1)),t=createSolidColorFunction(new vec4(1,1,1,1)),r=createSolidColorFunction(new vec4(0,0,0,1)),a=[0,-.3];for(let n=6;n>0;n--){let e=.1*n;webgl_webgl.shapes.push.apply(webgl_webgl.shapes,createSquare(a[0]-e,a[1]-e,a[0]+e,a[1]+e,n%2==0?t:r))}webgl_webgl.shapes.push.apply(webgl_webgl.shapes,createEllipse(.6,.7,.2,.2,(e,t)=>{var r=new Array(t-e);for(let a=e;a<t;a++)r[a]=new vec4(a/(t-e),0,0,1);return r})),webgl_webgl.shapes.push.apply(webgl_webgl.shapes,createEllipse(-.6,.625,.2,.12,e)),webgl_webgl.shapes.push.apply(webgl_webgl.shapes,createTriangle(0,1,-.3,.5,.3,.5,rainbowColorFunction)),renderShapes(webgl_webgl)}function createCanvas3(){webgl_webgl&&webgl_webgl.cleanup(webgl_webgl),(webgl_webgl=StandardWebGL(document.getElementById("gl-canvas"))).UseBasic(webgl_webgl),webgl_webgl.rot[0]=45,webgl_webgl.height=.5,webgl_webgl.shapes.push.apply(webgl_webgl.shapes,createMesh(CUBE,(e,t)=>[vec4(1,0,0,1),vec4(1,1,0,1),vec4(1,1,1,1),vec4(1,0,1,1),vec4(0,0,0,1),vec4(0,0,1,1),vec4(0,1,1,1),vec4(0,1,0,1)])),renderShapes(webgl_webgl)}function createCanvas4(){webgl_webgl&&webgl_webgl.cleanup(webgl_webgl),(webgl_webgl=StandardWebGL(document.getElementById("gl-canvas"))).UseBasic(webgl_webgl),webgl_webgl.shapes.push.apply(webgl_webgl.shapes,createMeshUniqueVertices(BUNNY,null)),renderShapes(webgl_webgl)}function createCanvas5(){webgl_webgl&&webgl_webgl.cleanup(webgl_webgl),(webgl_webgl=StandardWebGL(document.getElementById("gl-canvas"))).UsePhong(webgl_webgl),webgl_webgl.shapes.push.apply(webgl_webgl.shapes,createMeshUniqueVertices(TEAPOT,null)),renderShapes(webgl_webgl)}function roundToFixed(e,t){return parseFloat((Math.round(e*Math.pow(10,t))/Math.pow(10,t)).toFixed(t))}function changeModel(){let e=document.getElementById("modelSelection"),t=e.options[e.selectedIndex].value.toUpperCase();CurrentModel!=t&&("BUNNY"==t?webgl_webgl.shapes=createMeshUniqueVertices(BUNNY,null):"CUBE"==t?webgl_webgl.shapes=createMeshUniqueVertices(CUBE,null):"FISH"==t?webgl_webgl.shapes=createMeshUniqueVertices(FISH,null):"SPHERE"==t?webgl_webgl.shapes=createMeshUniqueVertices(SPHERE,null):"TEAPOT"==t&&(webgl_webgl.shapes=createMeshUniqueVertices(TEAPOT,null)),changeMaterial(),CurrentModel=t,webgl_webgl.changed=!0)}function changeMaterial(){let e=document.getElementById("materialSelection"),t=e.options[e.selectedIndex].value.toUpperCase(),r=MAT_DEFAULT;if("GOLD"==t)r={ambient:vec4(218/255,165/255,32/255,1),diffuse:vec4(1,215/255,0,1),specular:vec4(238/255,232/255,170/255,1),shininess:5};else if("COAL"==t)r={ambient:vec4(.1,.1,.1,1),diffuse:vec4(.3,.3,.3,1),specular:vec4(.1,.1,.1,1),shininess:1e4};else if("POLISHEDSILVER"==t)r={ambient:vec4(169/255,169/255,169/255,1),diffuse:vec4(192/255,192/255,192/255,1),specular:vec4(211/255,211/255,211/255,1),shininess:20};else{if("REDSHINY"!=t)return;r={ambient:vec4(.6,.2,.2,1),diffuse:vec4(.9,.1,.1,1),specular:vec4(.8,.8,.8,1),shininess:80}}webgl_webgl.shapes.forEach(e=>{e.material=r}),webgl_webgl.changed=!0}function updateLightDirectedVal(){let e=document.getElementById("directedLight").checked;webgl_webgl.light.directed=e,document.getElementById("directedLabel").innerHTML=e?"On  ":"Off  ",webgl_webgl.changed=!0}function applyLightData(e,t){if(e.attributes.simple)return;let r=e.attributes.vecDiffuseL,a=e.attributes.vecSpecularL,n=e.attributes.vecLight;e.gl.uniform4fv(e.attributes.vecAmbientL,flatten(t.ambient)),e.gl.uniform4fv(r,flatten(t.diffuse)),e.gl.uniform4fv(a,flatten(t.specular)),e.gl.uniform4fv(n,flatten(t.source))}function applyMaterialData(e,t){if(e.attributes.simple)return;let r=e.attributes.vecAmbientM,a=e.attributes.vecDiffuseM,n=e.attributes.vecSpecularM,l=e.attributes.floatShininess;null!=t?(e.gl.uniform4fv(r,flatten(t.ambient)),e.gl.uniform4fv(a,flatten(t.diffuse)),e.gl.uniform4fv(n,flatten(t.specular)),e.gl.uniform1f(l,t.shininess)):(e.gl.uniform4fv(r,flatten(MAT_DEFAULT.ambient)),e.gl.uniform4fv(a,flatten(MAT_DEFAULT.diffuse)),e.gl.uniform4fv(n,flatten(MAT_DEFAULT.specular)),e.gl.uniform1f(l,MAT_DEFAULT.shininess))}function renderShapes(e){let t=[],r=[];function a(){r=[],e.shapes.forEach(e=>{let t={size:0,points:[],colors:[],normals:[],indices:[],material:null};e.points.forEach(e=>t.points.push(e)),e.colors.forEach(e=>t.colors.push(e)),e.normals.forEach(e=>t.normals.push(e)),e.indices.forEach(e=>t.indices.push(e)),t.material=e.material,t.size=t.indices.length,r.push(t)}),e.bufferData=setupAttributeBuffers(e,r[0]),e.bufferData.prepMultiBuffer(r[0]),applyMaterialData(e,r[0].material),(t||[]).length>0&&(t.disablePos(),t.disableNorm(),t.disableColor(),t.deleteBuffers()),t=e.bufferData}a(),function n(l){if(null==e.attributes)return;e.changed&&(e.changed=!1,a()),e.gl.clear(e.gl.COLOR_BUFFER_BIT|e.gl.DEPTH_BUFFER_BIT);let i=null;if(e.fieldDepth)if(e.fieldDepth.constructor===Array)if(3==e.fieldDepth.length){let t=Math.abs(e.fieldDepth[0]),r=Math.abs(e.fieldDepth[1]),a=Math.abs(e.fieldDepth[2]);i=[-t,t,-r,r,-a,a]}else i=e.fieldDepth;else{let t=Math.abs(e.fieldDepth);i=[-t,t,-t,t,-t,t]}else i=[-1,1,-1,1,-1,1];let s=Math.sin(Math.PI/(2*e.radius)*(Math.abs(e.height)+e.radius)),o=Math.sin(Math.PI/(2*e.light.radius)*(Math.abs(e.light.height)+e.light.radius)),c=vec3(s*e.radius*Math.sin(radians(e.rot[0])),e.height,s*e.radius*Math.cos(radians(e.rot[0])));e.light.source=vec3(o*e.light.radius*Math.sin(radians(e.light.rot[0])),e.light.height,o*e.light.radius*Math.cos(radians(e.light.rot[0]))),e.light.source=vec4(e.light.source,e.light.directed?1:0);let u=lookAt(c,e.center,up),g=null;g=e.projection==PROJECTIONS.Parallel?ortho(i[0],i[1],i[2],i[3],i[4],i[5]):perspective(e.fov,e.aspect,i[4],i[5]),e.gl.uniformMatrix4fv(e.attributes.matrixView,!1,flatten(u)),e.attributes.simple||e.gl.uniformMatrix3fv(e.attributes.matrixNormal,!1,flatten([normalize(u[0].slice(0,3)),normalize(u[1].slice(0,3)),normalize(u[2].slice(0,3))])),e.gl.uniformMatrix4fv(e.attributes.matrixProject,!1,flatten(g)),applyLightData(e,e.light),r.forEach(a=>{r.length>1&&(t.prepMultiBuffer(a),applyMaterialData(e,a.material)),e.gl.drawElements(e.gl.TRIANGLES,a.size,e.gl.UNSIGNED_SHORT,0)}),window.requestAnimationFrame(n)}()}function StandardWebGL(e){var t=WebGLUtils.setupWebGL(e);t||alert("WebGL isn't available"),t.viewport(0,0,e.width,e.height),t.clearColor(0,0,0,1),t.clearDepth(1),t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL);var r=initShaders(t,VERT_SHADER_GOURAUD,FRAG_SHADER_GOURAUD),a=initShaders(t,VERT_SHADER_PHONG,FRAG_SHADER_PHONG),n=initShaders(t,VERT_SHADER_BASIC,FRAG_SHADER_BASIC),l=getProgramAttributesComplex(t,r),i=getProgramAttributesComplex(t,a),s=getProgramAttributesBasic(t,n);return t.useProgram(r),{gl:t,program:r,programName:"Gouraud",attributes:l,shapes:[],changed:!1,fieldDepth:2,fov:45,aspect:e.width/e.height,projection:PROJECTIONS.Parallel,rot:[0,0,0],height:0,radius:1,center:vec3(0,0,0),light:{ambient:vec4(.2,.2,.2,1),diffuse:vec4(.6,.6,.6,1),specular:vec4(1,1,1,1),source:vec4(0,0,0,0),rot:[0,0,0],height:0,radius:1,directed:!1},bufferData:null,cleanup:e=>{null!=e.bufferData&&(e.bufferData.disablePos(),e.bufferData.disableNorm(),e.bufferData.disableColor(),e.bufferData.deleteBuffers()),e.attributes=null,e.bufferData=null},UseGouraud:e=>{"Gouraud"!=e.programName&&(e.programName="Gouraud",e.gl.useProgram(r),e.attributes=l,null!=e.bufferData&&e.bufferData.updateProgram(),e.changed=!0)},UsePhong:e=>{"Phong"!=e.programName&&(e.programName="Phong",e.gl.useProgram(a),e.attributes=i,null!=e.bufferData&&e.bufferData.updateProgram(),e.changed=!0)},UseBasic:e=>{"Basic"!=e.programName&&(e.programName="Basic",e.gl.useProgram(n),e.attributes=s,null!=e.bufferData&&e.bufferData.updateProgram(),e.changed=!0)}}}function getProgramAttributesComplex(e,t){return{positionAttribute:e.getAttribLocation(t,"vPosition"),normalAttribute:e.getAttribLocation(t,"vNormal"),matrixView:e.getUniformLocation(t,"uModel"),matrixNormal:e.getUniformLocation(t,"uNormal"),matrixProject:e.getUniformLocation(t,"uProject"),vecAmbientL:e.getUniformLocation(t,"uLightAmbient"),vecDiffuseL:e.getUniformLocation(t,"uLightDiffuse"),vecSpecularL:e.getUniformLocation(t,"uLightSpecular"),vecLight:e.getUniformLocation(t,"uLightPos"),vecAmbientM:e.getUniformLocation(t,"uMaterialAmbient"),vecDiffuseM:e.getUniformLocation(t,"uMaterialDiffuse"),vecSpecularM:e.getUniformLocation(t,"uMaterialSpecular"),floatShininess:e.getUniformLocation(t,"uShiny"),simple:!1}}function getProgramAttributesBasic(e,t){return{positionAttribute:e.getAttribLocation(t,"vPosition"),colorAttribute:e.getAttribLocation(t,"vColor"),matrixView:e.getUniformLocation(t,"uModel"),matrixProject:e.getUniformLocation(t,"uProject"),simple:!0}}function setupAttributeBuffers(e,t){var r=null,a=null,n=null,l=null,i=null,s=null,o=null;return r=e.gl.createBuffer(),i=e.attributes.positionAttribute,e.gl.bindBuffer(e.gl.ARRAY_BUFFER,r),e.gl.bufferData(e.gl.ARRAY_BUFFER,flatten(t.points),e.gl.STATIC_DRAW),e.gl.vertexAttribPointer(i,3,e.gl.FLOAT,!1,0,0),e.gl.enableVertexAttribArray(i),e.attributes.simple?(n=e.gl.createBuffer(),o=e.attributes.normalAttribute,e.gl.bindBuffer(e.gl.ARRAY_BUFFER,n),e.gl.bufferData(e.gl.ARRAY_BUFFER,flatten(t.normals),e.gl.STATIC_DRAW),e.gl.vertexAttribPointer(o,4,e.gl.FLOAT,!1,0,0),e.gl.enableVertexAttribArray(o)):(a=e.gl.createBuffer(),s=e.attributes.normalAttribute,e.gl.bindBuffer(e.gl.ARRAY_BUFFER,a),e.gl.bufferData(e.gl.ARRAY_BUFFER,flatten(t.normals),e.gl.STATIC_DRAW),e.gl.vertexAttribPointer(s,3,e.gl.FLOAT,!1,0,0),e.gl.enableVertexAttribArray(s)),l=e.gl.createBuffer(),e.gl.bindBuffer(e.gl.ELEMENT_ARRAY_BUFFER,l),e.gl.bufferData(e.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(t.indices),e.gl.DYNAMIC_DRAW),{disablePos:()=>null!=i?e.gl.disableVertexAttribArray(i):void 0,disableNorm:()=>null!=s?e.gl.disableVertexAttribArray(s):void 0,disableColor:()=>null!=o?e.gl.disableVertexAttribArray(o):void 0,prepMultiBuffer:t=>{e.gl.deleteBuffer(r),r=e.gl.createBuffer(),i=e.attributes.positionAttribute,e.gl.bindBuffer(e.gl.ARRAY_BUFFER,r),e.gl.bufferData(e.gl.ARRAY_BUFFER,flatten(t.points),e.gl.STATIC_DRAW),e.gl.vertexAttribPointer(i,3,e.gl.FLOAT,!1,0,0),e.gl.enableVertexAttribArray(i),e.attributes.simple?(n=e.gl.createBuffer(),o=e.attributes.colorAttribute,e.gl.bindBuffer(e.gl.ARRAY_BUFFER,n),e.gl.bufferData(e.gl.ARRAY_BUFFER,flatten(t.colors),e.gl.STATIC_DRAW),e.gl.vertexAttribPointer(o,4,e.gl.FLOAT,!1,0,0),e.gl.enableVertexAttribArray(o)):(a=e.gl.createBuffer(),s=e.attributes.normalAttribute,e.gl.bindBuffer(e.gl.ARRAY_BUFFER,a),e.gl.bufferData(e.gl.ARRAY_BUFFER,flatten(t.normals),e.gl.STATIC_DRAW),e.gl.vertexAttribPointer(s,3,e.gl.FLOAT,!1,0,0),e.gl.enableVertexAttribArray(s)),e.gl.bufferData(e.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(t.indices),e.gl.DYNAMIC_DRAW)},deleteBuffers:()=>{e.gl.deleteBuffer(r),e.gl.deleteBuffer(e.attributes.simple?n:a),e.gl.deleteBuffer(l)},updateProgram:()=>{let t=e.gl.createBuffer();i=e.attributes.positionAttribute,e.gl.bindBuffer(e.gl.ARRAY_BUFFER,t),e.gl.vertexAttribPointer(i,3,e.gl.FLOAT,!1,0,0),e.gl.enableVertexAttribArray(i);let c=null,u=null;e.attributes.simple?(u=e.gl.createBuffer(),o=e.attributes.colorAttribute,e.gl.bindBuffer(e.gl.ARRAY_BUFFER,u),e.gl.vertexAttribPointer(o,4,e.gl.FLOAT,!1,0,0),e.gl.enableVertexAttribArray(o)):(c=e.gl.createBuffer(),s=e.attributes.normalAttribute,e.gl.bindBuffer(e.gl.ARRAY_BUFFER,c),e.gl.vertexAttribPointer(s,3,e.gl.FLOAT,!1,0,0),e.gl.enableVertexAttribArray(s));let g=e.gl.createBuffer();e.gl.bindBuffer(e.gl.ELEMENT_ARRAY_BUFFER,g),e.gl.deleteBuffer(r),null!=a&&e.gl.deleteBuffer(a),null!=n&&e.gl.deleteBuffer(n),e.gl.deleteBuffer(l),l=g,n=u,a=c,r=t}}}function createMesh(e,t){let r=[],a=[],n=[],l=[0,0,0],i=null,s=0,o=0;for(var c=0;c<e.length;c+=4)if("v"==e[c]){let t=new vec3(e.slice(c+1,c+4));r.push.apply(r,t),a.push.apply(a,normalize(t)),l[0]+=e[c+1],l[1]+=e[c+2],l[2]+=e[c+3],s++}else"f"==e[c]?(n.push(e[c+1]),n.push(e[c+2]),n.push(e[c+3]),e[c+1]>o&&(o=e[c+1]),e[c+2]>o&&(o=e[c+2]),e[c+3]>o&&(o=e[c+3])):"c"==e[c]&&(i=[e[c+1],e[c+2],e[c+3]]);if(!n.includes(0)&&o>r.length/3-1)for(let u=0;u<n.length;u++)n[u]=n[u]-1;return n.length>65535?_breakShape(r,n,t):(l[0]/=s,l[1]/=s,l[2]/=s,[{points:r,colors:(t||defaultColorFunction).apply(this,[n,r]),normals:a,indices:n,center:l,boundingCenter:i,material:{ambient:vec4(.6,.2,.2,1),diffuse:vec4(.9,.1,.1,1),specular:vec4(.8,.8,.8,1),shininess:80}}])}function createMeshUniqueVertices(e,t){let r=[],a=[],n=[],l=[],i=[],s=[0,0,0],o=null,c=0,u=0;for(var g=0;g<e.length;g+=4)"v"==e[g]?(r.push.apply(r,new vec3(e.slice(g+1,g+4))),s[0]+=e[g+1],s[1]+=e[g+2],s[2]+=e[g+3],c++):"f"==e[g]?(a.push.apply(a,e.slice(g+1,g+4)),e[g+1]>u&&(u=e[g+1]),e[g+2]>u&&(u=e[g+2]),e[g+3]>u&&(u=e[g+3])):"c"==e[g]&&(o=[e[g+1],e[g+2],e[g+3]]);if(!a.includes(0)&&u>r.length/3-1)for(let f=0;f<a.length;f++)a[f]=a[f]-1;return a.length>65535?_breakShape(r,a,t):(a.forEach(e=>{let t=new vec3(r.slice(3*e,3*e+3));n.push.apply(n,t),l.push.apply(l,normalize(t)),i.push(i.length)}),s[0]/=c,s[1]/=c,s[2]/=c,[{points:n,colors:(t||defaultColorFunction).apply(this,[i,n]),normals:l,indices:i,center:s,boundingCenter:o,material:{ambient:vec4(.6,.2,.2,1),diffuse:vec4(.9,.1,.1,1),specular:vec4(.8,.8,.8,1),shininess:80}}])}function _breakShape(e,t,r){let a=[],n=[],l=t.length;for(;l>32766;)a.push(32766),l-=32766;return l>0&&a.push(l),l=0,a.forEach(a=>{let i=[0,0,0],s=[],o=[],c=[];t.slice(l,l+a).forEach(t=>{let r=new vec3(e.slice(3*t,3*t+3));s.push.apply(s,r),c.push.apply(c,normalize(r)),i[0]+=e[3*t],i[1]+=e[3*t+1],i[2]+=e[3*t+2],o.push(o.length)}),i[0]/=o.length,i[1]/=o.length,i[2]/=o.length,n.push({points:s,colors:(r||defaultColorFunction).apply(this,[t,e]),normals:c,indices:o,center:i,material:{ambient:vec4(.6,.2,.2,1),diffuse:vec4(.9,.1,.1,1),specular:vec4(.8,.8,.8,1),shininess:80}}),l+=a}),n}function createSquare(e,t,r,a,n){return createRectangle(e,t,e,a,r,a,r,t,n)}function createRectangle(e,t,r,a,n,l,i,s,o){let c=[new vec3(e,t,0),new vec3(r,a,0),new vec3(n,l,0),new vec3(i,s,0)],u=(e+r+n+i)/4,g=(t+a+l+s)/4;return[{points:c,colors:(o||blendedRainbowColorFunction).apply(this,[0,c.length]),normals:c,indices:[0,1,2,0,2,3],center:[u,g,0],material:{ambient:vec4(.6,.2,.2,1),diffuse:vec4(.9,.1,.1,1),specular:vec4(.8,.8,.8,1),shininess:80}}]}function createRegularPentagon(e,t,r,a){var n=Math.cos(radians(18))*r,l=Math.cos(radians(288))*r*1.5,i=Math.sin(radians(18))*r,s=Math.sin(radians(288))*r/1.25;return createPentagon(e+n,t+i,e,t+r,e-n,t+i,e-l,t+s,e+l,t+s,colorFunction)}function createPentagon(e,t,r,a,n,l,i,s,o,c,u){let g=[new vec3(e,t,0),new vec3(r,a,0),new vec3(n,l,0),new vec3(i,s,0),new vec3(o,c,0)],f=(e+r+n+i+o)/5,h=(t+a+l+s+c)/5;return[{points:g,colors:(u||blendedRainbowColorFunction).apply(this,[0,g.length]),normals:g,indices:[0,1,3,0,3,4,1,2,3],center:[f,h,0],material:{ambient:vec4(.6,.2,.2,1),diffuse:vec4(.9,.1,.1,1),specular:vec4(.8,.8,.8,1),shininess:80}}]}function createTriangle(e,t,r,a,n,l,i){let s=[new vec3(e,t,0),new vec3(r,a,0),new vec3(n,l,0)],o=(e+r+n)/3,c=(t+a+l)/3;return[{points:s,colors:(i||blendedRainbowColorFunction).apply(this,[0,s.length]),normals:s,indices:[0,1,2],center:[o,c,0],material:{ambient:vec4(.6,.2,.2,1),diffuse:vec4(.9,.1,.1,1),specular:vec4(.8,.8,.8,1),shininess:80}}]}function createEllipse(e,t,r,a,n){let l=new Array(360),i=[],s=0,o=0;for(let c=0;c<360;c++)l[c]=new vec3(e+r*Math.cos(radians(c)),t+a*Math.sin(radians(c)),0),c>1&&i.push(0,c-1,c),s+=e+r*Math.cos(radians(c)),o+=t+a*Math.cos(radians(c));return s/=360,o/=360,[{points:l,colors:(n||blendedRainbowColorFunction).apply(this,[0,l.length]),normals:l,indices:i,center:[s,o,0],material:{ambient:vec4(.6,.2,.2,1),diffuse:vec4(.9,.1,.1,1),specular:vec4(.8,.8,.8,1),shininess:80}}]}function createEllipse_CenterColor(e,t,r,a,n,l){let i=new Array(362),s=[];i[0]=new vec3(e,t,0);for(let c=0;c<360;c++)i[c+1]=new vec3(e+r*Math.cos(radians(c)),t+a*Math.sin(radians(c))),c>1&&s.push(0,c-1,c);i[361]=new vec2(e+r,t);let o=(l||blendedRainbowColorFunction).apply(this,[1,i.length-1]);return o.push(o[0]),[{points:i,colors:[n].concat(o),normals:i,indices:s,center:[xAvg,yAvg,0],material:{ambient:vec4(.6,.2,.2,1),diffuse:vec4(.9,.1,.1,1),specular:vec4(.8,.8,.8,1),shininess:80}}]}